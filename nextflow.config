process {
    maxRetries = 2
    withLabel:process_single {
        cpus   = 1 
        memory = 1.GB 
        time   = 1.h 
        queue  = "short" 
    }
    withLabel:process_low {
        cpus   = 2    
        memory = 4.GB
        time   = 3.h 
        queue  = "short" 
    }
    withLabel:process_medium {
        cpus   = 6    
        memory = 24.GB 
        time   = 12.h 
        queue  = "short" 
    }
    withLabel:process_high {
        cpus   = 16 
        memory = 120.GB
        time   = 12.h  
        queue  = "short" 
    }

    withName: ASSEMBLY_FINDER {
    ext.args = "--no-use-conda --compressed False"
    publishDir = [
        path: { "${params.outdir}/download" },
        mode: "copy",
        pattern: "*/*.tsv"
    ]
}
    withName: CAMISIM_TABLES {
    publishDir = [
        path: { "${params.outdir}/camisim" },
        mode: "copy",
        pattern: "*/*.tsv"
    ]
}
    withName: CAMISIM_CONFIG {
    publishDir = [
        path: { "${params.outdir}/camisim" },
        mode: "copy",
        pattern: "*.ini"
    ]
}
    withName: CAMISIM_SIMULATE {
    publishDir = [
        path: { "${params.outdir}/camisim" },
        mode: "copy",
        pattern: "**/*.{bam,txt,gz}"
    ]
}

    withName: SEQKIT_SPLIT2 {
    publishDir = [
        path: { "${params.outdir}/camisim" },
        mode: "copy",
        pattern: "*.fq.gz"
    ]
}


    withName: MESS {
    publishDir = [
        path: { "${params.outdir}/mess" },
        mode: "copy",
        pattern: "**/*.{bam,txt,fq.gz}"
    ]
}

}

apptainer {
  enabled = true
  autoMounts = true
  cacheDir = "/mnt/slow_storage/containers"
}

//executor {
//    name = "slurm"
//    perCpuMemAllocation = true
//}

def trace_timestamp = new java.util.Date().format( 'yyyy-MM-dd_HH-mm-ss')
timeline {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_timeline_${trace_timestamp}.html"
}
report {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_report_${trace_timestamp}.html"
}
trace {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_trace_${trace_timestamp}.txt"
}
dag {
    enabled = true
    file    = "${params.outdir}/pipeline_info/pipeline_dag_${trace_timestamp}.html"
}